# Cluster Visualizer

A comprehensive toolkit for 42 cluster usage analysis, featuring both interactive pygame visualizations and statistical plots.

## Overview

This tool provides multiple ways to analyze cluster usage:
- **Interactive Heatmap** (`visualize.py`): Real-time pygame visualization of cluster layout
- **Statistical Plots** (`visualize_usage.py`): Generate graphs showing usage patterns across days
- **Data Fetcher** (`fetch_data.py`): Collect and process cluster usage data

## Features

### Interactive Heatmap (visualize.py)
- **Interactive Heatmap**: Visual representation of cluster usage with color-coded computers
- **Multiple Time Windows**: View statistics for 1 day, 7 days, 30 days, or all-time
- **Hover Tooltips**: Detailed information for each computer on hover
- **Real Layout**: Mimics the actual cluster layout with zones Z1-Z4
- **Export Function**: Save screenshots of the current view

### Usage Statistics Plots (visualize_usage.py)
- **Individual Day Plots**: Separate graphs for each day of the week
- **Weekly Comparison**: All days overlaid on a single graph
- **Weekday vs Weekend**: Compare weekday and weekend usage patterns
- **Heatmap**: Visual representation of usage across days and hours
- **Averaged Data**: Shows mean concurrent users across all occurrences of each day

## Installation

Make sure to use a virtual environment and install the required dependencies:
```bash
python3 -m venv .venv
source .venv/bin/activate
python3 -m pip install -r requirements.txt
```

### Basic Usage

#### Fetching Data

The `fetch_data.py` script generates a `cluster.json` file containing the cluster usage data:
```bash
python3 fetch_data.py
```

#### Interactive Visualization

You can directly use `visualize.py` to generate and see the visualization in one step.
```bash
python3 visualize.py
```
If you already have a `cluster.json` file, you can specify it as follows:
```bash
python3 visualize.py cluster.json
```
If no json file is provided, it defaults to `cluster.json`.  
If the file does not exist, the program generate it with `fetch_data.py`

#### Statistical Plots

Generate usage statistics plots:
```bash
# Generate all plots (saves PNG files)
python3 visualize_usage.py

# Generate specific plots
python3 visualize_usage.py --plot comparison heatmap

# Display plots interactively instead of saving
python3 visualize_usage.py --show

# Save as PDF instead of PNG
python3 visualize_usage.py --format pdf

# Specify custom input and output
python3 visualize_usage.py --input cluster.json --output-dir ./graphs
```

Available plot types:
- `individual` - Separate subplot for each day of the week with peak annotations
- `comparison` - All days overlaid on a single graph for easy comparison
- `weekday-weekend` - Average weekday usage vs average weekend usage
- `heatmap` - 2D heatmap showing usage intensity across days and hours
- `all` - Generate all plot types (default)

### With Time Window Selection

```bash
python3 visualize.py cluster.json --time-window 7d
```

Available time windows:
- `1d` - Last 24 hours (keyboard shortcut: `1`)
- `7d` - Last 7 days (default) (keyboard shortcut: `7`)
- `30d` - Last 30 days (keyboard shortcut: `3`)
- `all_time` - All available data (keyboard shortcut: `A`)

### Example

```bash
# Generate data
python3 fetch_data.py --url https://api.raraph.fr/intra-metrics/sessions

# Visualize with 7-day window
python3 visualize.py cluster.json --time-window 7d
```

## Keyboard Controls

While the visualizer is running:

| Key | Action |
|-----|--------|
| `1` | Switch to 1-day view |
| `7` | Switch to 7-day view |
| `3` | Switch to 30-day view |
| `A` | Switch to all-time view |
| `E` | Export current view as PNG |
| `R` | Refresh data from JSON file |
| `Q` or `ESC` | Quit the application |

## Color Legend

The heatmap uses a color gradient to represent usage:

- **Light Blue** (0%): Unused or minimal usage
- **Blue** (25%): Low usage
- **Green** (50%): Medium usage
- **Orange** (75%): High usage
- **Red** (100%): Very high usage / constantly in use

## Layout

The visualizer displays the cluster in two floors:

### Upper Floor
- **Z2** (left): 12 rows, positions 1-8
- **Z1** (right): 12 rows, positions 1-5

### Lower Floor
- **Z4** (left): 13 rows, positions 1-7
- **Z3** (right): 13 rows, positions 1-6

Each computer shows its position number and is colored based on usage percentage.

## Tooltip Information

When hovering over a computer, you'll see:
- **Computer Name**: e.g., "z1r12p1"
- **Usage Percentage**: How much the computer was used in the selected time window
- **Session Count**: Number of login sessions
- **Average Duration**: Average session length in hours

## Export

Press `E` to export the current view as a PNG image. The file will be saved with a timestamp:
```
cluster_heatmap_7d_20260202_143022.png
```

## Technical Details

### Data Source
The visualizer reads the JSON file generated by `fetch_data.py`, which contains:
- Session data for each computer
- Pre-calculated statistics for different time windows
- Usage percentages, session counts, and average durations

### Performance
- Runs at 30 FPS for smooth interaction
- Efficient rendering with pygame (and because I only know to use pygame)
- Real-time tooltip updates on mouse movement

## Troubleshooting


### Window Too Large
The visualization is designed for standard desktop displays (1920x1080 or larger). If the window is too large for your screen, you can modify the `COMPUTER_SIZE` and spacing constants in the code.

## Future Enhancements

Potential features for future versions:
- Click to show detailed computer history
- Time-based animation showing usage over time
- Compare different time periods
- Real-time updates when new data is available

## License
This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.
