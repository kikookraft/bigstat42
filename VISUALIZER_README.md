# Cluster Visualizer

A pygame-based interactive heatmap visualization for 42 cluster usage statistics.

## Overview

This tool creates a visual representation of the cluster layout, mimicking the actual physical layout with zones, rows, and individual computer positions. Each computer is color-coded based on its usage percentage, creating an intuitive heatmap.

## Features

- **Interactive Heatmap**: Visual representation of cluster usage with color-coded computers
- **Multiple Time Windows**: View statistics for 1 day, 7 days, 30 days, or all-time
- **Hover Tooltips**: Detailed information for each computer on hover
- **Real Layout**: Mimics the actual cluster layout with zones Z1-Z4
- **Export Function**: Save screenshots of the current view
- **Keyboard Controls**: Easy navigation and time window switching

## Installation

Make sure pygame is installed:

```bash
pip install pygame
```

Or install all requirements:

```bash
pip install -r requirements.txt
```

## Usage

### Basic Usage

1. First, generate the cluster data JSON file:
```bash
python main.py
```

This will create `cluster.json` with all the cluster usage data.

2. Run the visualizer:
```bash
python cluster_visualizer.py cluster.json
```

### With Time Window Selection

```bash
python cluster_visualizer.py cluster.json --time-window 7d
```

Available time windows:
- `1d` - Last 24 hours
- `7d` - Last 7 days (default)
- `30d` - Last 30 days
- `all_time` - All available data

### Example

```bash
# Generate data
python main.py --url https://api.raraph.fr/intra-metrics/sessions

# Visualize with 7-day window
python cluster_visualizer.py cluster.json --time-window 7d
```

## Keyboard Controls

While the visualizer is running:

| Key | Action |
|-----|--------|
| `1` | Switch to 1-day view |
| `7` | Switch to 7-day view |
| `3` | Switch to 30-day view |
| `A` | Switch to all-time view |
| `E` | Export current view as PNG |
| `Q` or `ESC` | Quit the application |

## Color Legend

The heatmap uses a color gradient to represent usage:

- **Light Blue** (0%): Unused or minimal usage
- **Blue** (25%): Low usage
- **Green** (50%): Medium usage
- **Orange** (75%): High usage
- **Red** (100%): Very high usage / constantly in use

## Layout

The visualizer displays the cluster in two floors:

### Upper Floor
- **Z2** (left): 12 rows, positions 1-8
- **Z1** (right): 12 rows, positions 1-5

### Lower Floor
- **Z4** (left): 13 rows, positions 1-7
- **Z3** (right): 13 rows, positions 1-6

Each computer shows its position number and is colored based on usage percentage.

## Tooltip Information

When hovering over a computer, you'll see:
- **Computer Name**: e.g., "z1r12p1"
- **Usage Percentage**: How much the computer was used in the selected time window
- **Session Count**: Number of login sessions
- **Average Duration**: Average session length in hours

## Export

Press `E` to export the current view as a PNG image. The file will be saved with a timestamp:
```
cluster_heatmap_7d_20260202_143022.png
```

## Technical Details

### Screen Layout
- Each computer is represented as a 45x45 pixel square
- Rows and zones are labeled for easy navigation
- The layout matches the physical cluster arrangement

### Data Source
The visualizer reads the JSON file generated by `main.py`, which contains:
- Session data for each computer
- Pre-calculated statistics for different time windows
- Usage percentages, session counts, and average durations

### Performance
- Runs at 30 FPS for smooth interaction
- Efficient rendering with pygame
- Real-time tooltip updates on mouse movement

## Troubleshooting

### "Error loading JSON file"
Make sure you've generated the cluster.json file first:
```bash
python main.py
```

### Pygame Import Error
Install pygame:
```bash
pip install pygame
```

### Window Too Large
The visualization is designed for standard desktop displays (1920x1080 or larger). If the window is too large for your screen, you can modify the `COMPUTER_SIZE` and spacing constants in the code.

## Future Enhancements

Potential features for future versions:
- Click to show detailed computer history
- Time-based animation showing usage over time
- Filter by zone or row
- Compare different time periods
- Real-time updates when new data is available

## License

Same as the main bigstat42 project.
